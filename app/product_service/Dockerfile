# Используем официальный образ Golang в качестве базового
FROM golang:1.23 AS builder

# Устанавливаем рабочую директорию внутри контейнера
WORKDIR /app

# Копируем файлы go.mod и go.sum для кэширования зависимостей
COPY go.mod go.sum ./

# Загружаем все зависимости
RUN go mod download

# Копируем исходный код в контейнер
COPY . .

# Собираем Go приложение
RUN go build -o product-service .

# Начинаем новый этап с пустого образа
FROM alpine:latest  

# Устанавливаем рабочую директорию внутри контейнера
WORKDIR /root/

# Копируем собранный бинарный файл из предыдущего этапа
COPY --from=builder /app/product-service .

# Открываем порт 8082 для внешнего мира
EXPOSE 8082

# Команда для запуска исполняемого файла
CMD ["./product-service"]